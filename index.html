<!doctype html>
<html>

<head>
	<title>GPS Mower</title>
	<style>
		#map {
			height: 500px;
			width: 700px;
		}
	</style>
</head>

<body>
	<div>
		GPS
		<hr />
		Latitude: <input type="text" id="lat" value="">
		<br />
		Longitude: <input type="text" id="lon" value="">
	</div>

	<br><br>

	<div>
		Sonars
		<hr />
		Channel 0: <input type="text" id="ch0" value="">
		<br />
		Channel 1: <input type="text" id="ch1" value="">
		<br />
		Channel 2: <input type="text" id="ch2" value="">
		<br />
		Channel 3: <input type="text" id="ch3" value="">
		<br />
	</div>

	<br><br>

	<div>
		Compass
		<hr />
		Heading: <input type="text" id="heading" value="">
		<br />
	</div>

	<br><br>

	<div>
		Map
		<hr />
		<div id="map"></div>
	</div>



	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>

	<script>

		//initialize google map vars
		var map = null
		var marker = null

		$(() => {

			//open socket for communication with backend
			var socket = io()

			socket.on('sensor data', msg => {
				//console.log(msg);

				if (msg.gps && msg.gps.lat && msg.gps.lon) {

					$('#lat').val(msg.gps.lat)
					$('#lon').val(msg.gps.lon)

					marker && marker.setPosition({
						lat: msg.gps.lat,
						lng: msg.gps.lon
					})
					//marker.setMap(map);
				}

				if (msg.sonars) {
					$('#ch0').val(msg.sonars.CHANNEL_0)
					$('#ch1').val(msg.sonars.CHANNEL_1)
					$('#ch2').val(msg.sonars.CHANNEL_2)
					$('#ch3').val(msg.sonars.CHANNEL_3)
				}

				if (msg.compass) {

					//update heading value on the page
					$('#heading').val(msg.compass.heading)

					//update heading value of the marker on the map
					marker.setIcon(({
						path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
						scale: 6,
						rotation: msg.compass.heading
					}))
				}
			})
		})


		//initialize google map
		initMap = () => {

			//create  a map
			map = new google.maps.Map(document.getElementById('map'), {
				center: { lat: 40.602826666666665, lng: -80.073335 },
				zoom: 20
			})

			//create a marker
			marker = new google.maps.Marker({
				map: map,
				title: 'GPS Mower!'
			})

			//replace default icon for a marker
			marker.setIcon(({
				path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
				scale: 6,
				rotation: 0
			}))

		}
	</script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvCDEAYYi6RI-_8C6kDrBfIyHans6KgYA&callback=initMap&libraries=geometry"
		async defer></script>

</body>

</html>